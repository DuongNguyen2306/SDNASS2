# üöÄ H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng API - Question Bank Management

## üìã T·ªïng quan
API n√†y cung c·∫•p c√°c ch·ª©c nƒÉng qu·∫£n l√Ω quiz v√† c√¢u h·ªèi cho h·ªá th·ªëng Question Bank Management.

### Base URL
```
http://localhost:3000
```

## üîß C√†i ƒë·∫∑t v√† ch·∫°y

### 1. C√†i ƒë·∫∑t dependencies
```bash
npm install
```

### 2. C·∫•u h√¨nh m√¥i tr∆∞·ªùng
T·∫°o file `.env` t·ª´ file `env.example`:
```bash
cp env.example .env
```

N·ªôi dung file `.env`:
```env
PORT=3000
MONGODB_URI=mongodb://localhost:27017
MONGODB_DB_NAME=SimpleQuiz
API_BASE_URL=http://localhost:3000
NODE_ENV=development
```

### 3. Ch·∫°y server
```bash
# Ch·∫°y production
npm start

# Ch·∫°y development (v·ªõi nodemon)
npm run dev
```

## üìö API Endpoints

### 1. Th√¥ng tin API
- **GET** `/api/info` - L·∫•y th√¥ng tin API v√† danh s√°ch endpoints
- **GET** `/health` - Health check

### 2. Quiz Management
- **GET** `/api/quizzes` - L·∫•y danh s√°ch t·∫•t c·∫£ quiz
- **POST** `/api/quizzes` - T·∫°o quiz m·ªõi
- **GET** `/api/quizzes/:id` - L·∫•y quiz theo ID
- **PUT** `/api/quizzes/:id` - C·∫≠p nh·∫≠t quiz
- **DELETE** `/api/quizzes/:id` - X√≥a quiz v√† t·∫•t c·∫£ questions li√™n quan

### 3. Question Management
- **GET** `/api/questions` - L·∫•y danh s√°ch t·∫•t c·∫£ questions
- **POST** `/api/questions` - T·∫°o question m·ªõi
- **GET** `/api/questions/:id` - L·∫•y question theo ID
- **PUT** `/api/questions/:id` - C·∫≠p nh·∫≠t question
- **DELETE** `/api/questions/:id` - X√≥a question v√† remove kh·ªèi quiz

### 4. Quiz-Question Operations
- **POST** `/api/quizzes/:id/question` - Th√™m 1 question v√†o quiz
- **POST** `/api/quizzes/:id/questions` - Th√™m nhi·ªÅu questions v√†o quiz
- **GET** `/api/quizzes/:id/populate` - L·∫•y quiz v·ªõi questions ch·ª©a keyword "capital"

## üíª C√°ch s·ª≠ d·ª•ng

### 1. S·ª≠ d·ª•ng api-config.js (Khuy·∫øn ngh·ªã)

```javascript
const { apiConfig, examples } = require('./api-config');

// L·∫•y t·∫•t c·∫£ quiz
async function getAllQuizzes() {
  try {
    const quizzes = await apiConfig.quizzes.getAll();
    console.log('Danh s√°ch quiz:', quizzes);
    return quizzes;
  } catch (error) {
    console.error('L·ªói:', error.message);
  }
}

// T·∫°o quiz m·ªõi
async function createNewQuiz() {
  try {
    const quiz = await apiConfig.quizzes.create({
      title: 'Quiz v·ªÅ Th·ªß ƒë√¥ c√°c n∆∞·ªõc',
      description: 'Test ki·∫øn th·ª©c v·ªÅ th·ªß ƒë√¥ c·ªßa c√°c qu·ªëc gia',
      questions: []
    });
    console.log('Quiz ƒë√£ t·∫°o:', quiz);
    return quiz;
  } catch (error) {
    console.error('L·ªói:', error.message);
  }
}

// T·∫°o question m·ªõi
async function createNewQuestion() {
  try {
    const question = await apiConfig.questions.create({
      text: 'Th·ªß ƒë√¥ c·ªßa Vi·ªát Nam l√† g√¨?',
      options: ['H√† N·ªôi', 'TP.HCM', 'ƒê√† N·∫µng', 'Hu·∫ø'],
      correctAnswerIndex: 0,
      keywords: ['capital', 'vietnam', 'hanoi']
    });
    console.log('Question ƒë√£ t·∫°o:', question);
    return question;
  } catch (error) {
    console.error('L·ªói:', error.message);
  }
}

// Ch·∫°y v√≠ d·ª•
examples.createQuizWithQuestions();
```

### 2. S·ª≠ d·ª•ng Fetch API

```javascript
// L·∫•y danh s√°ch quiz
async function getQuizzes() {
  try {
    const response = await fetch('http://localhost:3000/api/quizzes');
    const data = await response.json();
    console.log('Danh s√°ch quiz:', data);
    return data;
  } catch (error) {
    console.error('L·ªói:', error);
  }
}

// T·∫°o quiz m·ªõi
async function createQuiz() {
  try {
    const response = await fetch('http://localhost:3000/api/quizzes', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        title: 'My Quiz',
        description: 'Quiz description',
        questions: []
      })
    });
    const data = await response.json();
    console.log('Quiz ƒë√£ t·∫°o:', data);
    return data;
  } catch (error) {
    console.error('L·ªói:', error);
  }
}

// T·∫°o question m·ªõi
async function createQuestion() {
  try {
    const response = await fetch('http://localhost:3000/api/questions', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        text: 'What is the capital of France?',
        options: ['Paris', 'Lyon', 'Marseille', 'Toulouse'],
        correctAnswerIndex: 0,
        keywords: ['capital', 'france', 'paris']
      })
    });
    const data = await response.json();
    console.log('Question ƒë√£ t·∫°o:', data);
    return data;
  } catch (error) {
    console.error('L·ªói:', error);
  }
}
```

### 3. S·ª≠ d·ª•ng Axios

```javascript
const axios = require('axios');

const api = axios.create({
  baseURL: 'http://localhost:3000',
  headers: {
    'Content-Type': 'application/json'
  }
});

// L·∫•y danh s√°ch quiz
const getQuizzes = () => api.get('/api/quizzes');

// T·∫°o quiz
const createQuiz = (quizData) => api.post('/api/quizzes', quizData);

// T·∫°o question
const createQuestion = (questionData) => api.post('/api/questions', questionData);

// S·ª≠ d·ª•ng
async function example() {
  try {
    const quizzes = await getQuizzes();
    console.log('Quizzes:', quizzes.data);
  } catch (error) {
    console.error('L·ªói:', error.message);
  }
}
```

## üìù Response Format

### Success Response
```json
{
  "success": true,
  "data": { ... }
}
```

### Error Response
```json
{
  "success": false,
  "message": "Error message"
}
```

## üéØ V√≠ d·ª• chi ti·∫øt

### 1. T·∫°o quiz ho√†n ch·ªânh v·ªõi questions

```javascript
const { apiConfig } = require('./api-config');

async function createCompleteQuiz() {
  try {
    // B∆∞·ªõc 1: T·∫°o quiz
    const quiz = await apiConfig.quizzes.create({
      title: 'Quiz v·ªÅ ƒê·ªãa l√Ω Th·∫ø gi·ªõi',
      description: 'Test ki·∫øn th·ª©c v·ªÅ ƒë·ªãa l√Ω c√°c qu·ªëc gia',
      questions: []
    });
    console.log('‚úÖ Quiz ƒë√£ t·∫°o:', quiz.title);

    // B∆∞·ªõc 2: T·∫°o questions
    const questions = [
      {
        text: 'Th·ªß ƒë√¥ c·ªßa Vi·ªát Nam l√† g√¨?',
        options: ['H√† N·ªôi', 'TP.HCM', 'ƒê√† N·∫µng', 'Hu·∫ø'],
        correctAnswerIndex: 0,
        keywords: ['capital', 'vietnam', 'hanoi']
      },
      {
        text: 'Th·ªß ƒë√¥ c·ªßa Ph√°p l√† g√¨?',
        options: ['Lyon', 'Paris', 'Marseille', 'Toulouse'],
        correctAnswerIndex: 1,
        keywords: ['capital', 'france', 'paris']
      },
      {
        text: 'Th·ªß ƒë√¥ c·ªßa Nh·∫≠t B·∫£n l√† g√¨?',
        options: ['Osaka', 'Tokyo', 'Kyoto', 'Hiroshima'],
        correctAnswerIndex: 1,
        keywords: ['capital', 'japan', 'tokyo']
      },
      {
        text: 'Th·ªß ƒë√¥ c·ªßa Th√°i Lan l√† g√¨?',
        options: ['Bangkok', 'Chiang Mai', 'Phuket', 'Pattaya'],
        correctAnswerIndex: 0,
        keywords: ['capital', 'thailand', 'bangkok']
      }
    ];

    // B∆∞·ªõc 3: Th√™m questions v√†o quiz
    const result = await apiConfig.quizzes.addQuestions(quiz._id, questions);
    console.log('‚úÖ Questions ƒë√£ th√™m:', result.created.length);

    // B∆∞·ªõc 4: L·∫•y quiz v·ªõi questions ƒë√£ populate
    const finalQuiz = await apiConfig.quizzes.getById(quiz._id);
    console.log('‚úÖ Quiz ho√†n ch·ªânh:', finalQuiz);

    return finalQuiz;
  } catch (error) {
    console.error('‚ùå L·ªói:', error.message);
  }
}

// Ch·∫°y v√≠ d·ª•
createCompleteQuiz();
```

### 2. Qu·∫£n l√Ω questions

```javascript
const { apiConfig } = require('./api-config');

async function manageQuestions() {
  try {
    // L·∫•y t·∫•t c·∫£ questions
    const allQuestions = await apiConfig.questions.getAll();
    console.log('üìã T·∫•t c·∫£ questions:', allQuestions.length);

    // T·∫°o question m·ªõi
    const newQuestion = await apiConfig.questions.create({
      text: 'Th·ªß ƒë√¥ c·ªßa H√†n Qu·ªëc l√† g√¨?',
      options: ['Seoul', 'Busan', 'Incheon', 'Daegu'],
      correctAnswerIndex: 0,
      keywords: ['capital', 'korea', 'seoul']
    });
    console.log('‚úÖ Question m·ªõi:', newQuestion.text);

    // C·∫≠p nh·∫≠t question
    const updatedQuestion = await apiConfig.questions.update(newQuestion._id, {
      text: 'Th·ªß ƒë√¥ c·ªßa H√†n Qu·ªëc l√† th√†nh ph·ªë n√†o?',
      keywords: ['capital', 'korea', 'seoul', 'south korea']
    });
    console.log('‚úÖ Question ƒë√£ c·∫≠p nh·∫≠t:', updatedQuestion.text);

    // X√≥a question
    await apiConfig.questions.delete(newQuestion._id);
    console.log('‚úÖ Question ƒë√£ x√≥a');

  } catch (error) {
    console.error('‚ùå L·ªói:', error.message);
  }
}

// Ch·∫°y v√≠ d·ª•
manageQuestions();
```

### 3. T√¨m ki·∫øm questions theo keyword

```javascript
const { apiConfig } = require('./api-config');

async function searchCapitalQuestions() {
  try {
    // L·∫•y t·∫•t c·∫£ quiz
    const quizzes = await apiConfig.quizzes.getAll();
    
    for (const quiz of quizzes) {
      // L·∫•y quiz v·ªõi questions ch·ª©a keyword "capital"
      const quizWithCapital = await apiConfig.quizzes.getWithCapitalQuestions(quiz._id);
      
      if (quizWithCapital.data.questions.length > 0) {
        console.log(`üèõÔ∏è Quiz "${quiz.title}" c√≥ ${quizWithCapital.data.questions.length} c√¢u h·ªèi v·ªÅ th·ªß ƒë√¥:`);
        quizWithCapital.data.questions.forEach((q, index) => {
          console.log(`  ${index + 1}. ${q.text}`);
        });
      }
    }
  } catch (error) {
    console.error('‚ùå L·ªói:', error.message);
  }
}

// Ch·∫°y v√≠ d·ª•
searchCapitalQuestions();
```

## üîç Testing API

### 1. Test v·ªõi Postman
Import file `postman_collection.json` v√†o Postman ƒë·ªÉ test c√°c endpoints.

### 2. Test v·ªõi curl

```bash
# Health check
curl http://localhost:3000/health

# L·∫•y th√¥ng tin API
curl http://localhost:3000/api/info

# L·∫•y t·∫•t c·∫£ quiz
curl http://localhost:3000/api/quizzes

# T·∫°o quiz m·ªõi
curl -X POST http://localhost:3000/api/quizzes \
  -H "Content-Type: application/json" \
  -d '{"title":"Test Quiz","description":"Test Description","questions":[]}'
```

### 3. Test v·ªõi Node.js

```javascript
const { apiConfig, examples } = require('./api-config');

async function testAPI() {
  try {
    console.log('üîç Testing API...');
    
    // Test health check
    const health = await apiConfig.info.healthCheck();
    console.log('‚úÖ Health check:', health.data.status);
    
    // Test API info
    const info = await apiConfig.info.getApiInfo();
    console.log('‚úÖ API Info:', info.data.name);
    
    // Test t·∫°o quiz v·ªõi questions
    await examples.createQuizWithQuestions();
    
    console.log('‚úÖ T·∫•t c·∫£ tests ƒë√£ ho√†n th√†nh!');
  } catch (error) {
    console.error('‚ùå Test failed:', error.message);
  }
}

testAPI();
```

## üö® X·ª≠ l√Ω l·ªói

### Common Errors

1. **Connection Error**
   ```javascript
   // Ki·ªÉm tra server c√≥ ch·∫°y kh√¥ng
   const health = await apiConfig.info.healthCheck();
   ```

2. **Validation Error**
   ```javascript
   try {
     await apiConfig.questions.create({
       text: '', // Empty text s·∫Ω g√¢y l·ªói
       options: ['A', 'B'],
       correctAnswerIndex: 0
     });
   } catch (error) {
     console.error('Validation error:', error.message);
   }
   ```

3. **Not Found Error**
   ```javascript
   try {
     await apiConfig.quizzes.getById('invalid-id');
   } catch (error) {
     console.error('Not found:', error.message);
   }
   ```

## üìû H·ªó tr·ª£

N·∫øu g·∫∑p v·∫•n ƒë·ªÅ, h√£y ki·ªÉm tra:
1. Server c√≥ ƒëang ch·∫°y kh√¥ng (`http://localhost:3000/health`)
2. MongoDB c√≥ k·∫øt n·ªëi ƒë∆∞·ª£c kh√¥ng
3. C√°c dependencies ƒë√£ ƒë∆∞·ª£c c√†i ƒë·∫∑t ch∆∞a (`npm install`)
4. File `.env` ƒë√£ ƒë∆∞·ª£c t·∫°o ch∆∞a

## üéâ K·∫øt lu·∫≠n

API n√†y cung c·∫•p ƒë·∫ßy ƒë·ªß c√°c ch·ª©c nƒÉng ƒë·ªÉ qu·∫£n l√Ω quiz v√† questions. B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng `api-config.js` ƒë·ªÉ d·ªÖ d√†ng t√≠ch h·ª£p v√†o project c·ªßa m√¨nh, ho·∫∑c s·ª≠ d·ª•ng tr·ª±c ti·∫øp c√°c HTTP requests.

Ch√∫c b·∫°n code vui v·∫ª! üöÄ
Ch√∫c b·∫°n s·ª≠ d·ª•ng API th√†nh c√¥ng! üéâ